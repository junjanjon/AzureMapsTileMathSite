<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <script>
        const getInputValue = function (id) {
            return Number(document.getElementById(id).value);
        };

        const setInputValue = function (id, number) {
            document.getElementById(id).value = Number(number);
        };

        const orgRound = function (value, base) {
            return Math.round(value * (10**base)) / (10**base);
        }

        const convertFromLatLon = function()
        {
            const zoomLevel = getInputValue("zoomLevel");
            const position = [getInputValue("longitude"), getInputValue("latitude")];
            const tile = AzureMaps.TileMath.PositionToTileXY(position, zoomLevel, 256);
            setInputValue("tileX", tile.tileX);
            setInputValue("tileY", tile.tileY);
            const quadkey = AzureMaps.TileMath.TileXYToQuadKey(tile.tileX, tile.tileY, zoomLevel);
            setInputValue("quadkey", quadkey);
            setImage();
        }

        const convertFromTile = function()
        {
            const zoomLevel = getInputValue("zoomLevel");
            const tile = {
                tileX: getInputValue("tileX"),
                tileY: getInputValue("tileY")
            };
            const boundingBox = AzureMaps.TileMath.TileXYToBoundingBox(tile.tileX, tile.tileY, zoomLevel, 256);
            const centerX = (boundingBox[0] + boundingBox[2]) / 2;
            const centerY = (boundingBox[1] + boundingBox[3]) / 2;
            setInputValue("longitude", orgRound(centerX, 4));
            setInputValue("latitude", orgRound(centerY, 4));
            const quadkey = AzureMaps.TileMath.TileXYToQuadKey(tile.tileX, tile.tileY, zoomLevel);
            setInputValue("quadkey", quadkey);
            setImage();
        }

        const convertFromQuadKey = function()
        {
            const zoomLevel = getInputValue("zoomLevel");
            const quadkey = document.getElementById("quadkey").value;
            const tile = AzureMaps.TileMath.QuadKeyToTileXY(quadkey);
            setInputValue("tileX", tile.tileX);
            setInputValue("tileY", tile.tileY);
            const boundingBox = AzureMaps.TileMath.TileXYToBoundingBox(tile.tileX, tile.tileY, zoomLevel, 256);
            const centerX = (boundingBox[0] + boundingBox[2]) / 2;
            const centerY = (boundingBox[1] + boundingBox[3]) / 2;
            setInputValue("longitude", orgRound(centerX, 4));
            setInputValue("latitude", orgRound(centerY, 4));
            setImage();
        }

        const setImage = function()
        {
            const zoomLevel = getInputValue("zoomLevel");
            const tile = {
                tileX: getInputValue("tileX"),
                tileY: getInputValue("tileY")
            };
            const imageUrl = `https://tile.openstreetmap.org/${zoomLevel}/${tile.tileX}/${tile.tileY}.png`;
            document.getElementById("imageSrc").src = imageUrl;
            document.getElementById("imageUrl").href = imageUrl;
            document.getElementById("imageUrl").text = imageUrl;
        }
    </script>
    <script type="text/javascript" src="scripts/TileMath.js"></script>
    <title>AzureMapsTileMathSite</title>
    <style>
        label
        {
            display:block;
            float:left;
            width:250px;
        }

        ul.root > li {
            color: #2d8fdd;
            border-left: solid 6px #2d8fdd;/*左側の線*/
            background: #f1f8ff;/*背景色*/
            margin-bottom: 3px;/*下のバーとの余白*/
            line-height: 1.5;
            padding: 0.5em;
            list-style-type: none!important;/*ポチ消す*/
        }

        ul.inner > li {
            list-style-type: none!important;/*ポチ消す*/
        }
    </style>
</head>
<body>
<ul class="root">
    <li>
        <label for="zoomLevel">Zoom Level</label><input type="number" id="zoomLevel" value="12" />
    </li>
    <li>
        <form onsubmit="convertFromLatLon();return false">
            <ul class="inner">
                <li>
                    <label for="longitude">X / 経度 / longitude</label><input type="number" id="longitude" value="139.70" step="0.0001" />
                </li>
                <li>
                    <label for="latitude">Y / 緯度 / latitude</label><input type="number" id="latitude" value="35.68" step="0.0001" />
                    <button type="submit" class="btn btn-primary">Convert From LatLon</button>
                </li>
            </ul>
        </form>
    </li>
    <li>
        <form onsubmit="convertFromTile();return false">
            <ul class="inner">
                <li>
                    <label for="tileX">TileX</label><input type="number" id="tileX" value="3637" />
                </li>
                <li>
                    <label for="tileY">TileY</label><input type="number" id="tileY" value="1612" />
                    <button type="submit" class="btn btn-primary">Convert From Tile</button>
                </li>
            </ul>
        </form>
    </li>
    <li>
        <form onsubmit="convertFromQuadKey();return false">
            <ul class="inner">
                <li>
                    <label for="quadkey">quadkey</label><input type="number" id="quadkey" value="133002112301" />
                    <button type="submit" class="btn btn-primary">Convert From Quadkey</button>
                </li>
            </ul>
        </form>
    </li>
    <li>
        <div>
            <img id="imageSrc" src="https://tile.openstreetmap.org/12/3637/1612.png"><br />
            <p>
                <a id="imageUrl" href="https://tile.openstreetmap.org/12/3637/1612.png">https://tile.openstreetmap.org/12/3637/1612.png</a>
            </p>
        </div>
    </li>
</ul>
<div>
    <p><img id="imageSrc" src="images/GitHub-Mark-32px.png"> <a href="https://github.com/junjanjon/AzureMapsTileMathSite">https://github.com/junjanjon/AzureMapsTileMathSite</a></p>
</div>
</body>
</html>