<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <script>
        const getInputValue = function (id) {
            return Number(document.getElementById(id).value);
        };

        const setInputValue = function (id, number) {
            document.getElementById(id).value = Number(number);
        };

        const orgRound = function (value, base) {
            return Math.round(value * (10**base)) / (10**base);
        }

        const convertFromLatLon = function()
        {
            const zoomLevel = getInputValue("zoomLevel");
            const position = [getInputValue("longitude"), getInputValue("latitude")];
            const tile = AzureMaps.TileMath.PositionToTileXY(position, zoomLevel, 256);
            setInputValue("tileX", tile.tileX);
            setInputValue("tileY", tile.tileY);
            const quadkey = AzureMaps.TileMath.TileXYToQuadKey(tile.tileX, tile.tileY, zoomLevel);
            setInputValue("quadkey", quadkey);
        }

        const convertFromTile = function()
        {
            const zoomLevel = getInputValue("zoomLevel");
            const tile = {
                tileX: getInputValue("tileX"),
                tileY: getInputValue("tileY")
            };
            const boundingBox = AzureMaps.TileMath.TileXYToBoundingBox(tile.tileX, tile.tileY, zoomLevel, 256);
            const centerX = (boundingBox[0] + boundingBox[2]) / 2;
            const centerY = (boundingBox[1] + boundingBox[3]) / 2;
            setInputValue("longitude", orgRound(centerX, 4));
            setInputValue("latitude", orgRound(centerY, 4));
            const quadkey = AzureMaps.TileMath.TileXYToQuadKey(tile.tileX, tile.tileY, zoomLevel);
            setInputValue("quadkey", quadkey);
        }

        const convertFromQuadKey = function()
        {
            const zoomLevel = getInputValue("zoomLevel");
            const quadkey = document.getElementById("quadkey").value;
            const tile = AzureMaps.TileMath.QuadKeyToTileXY(quadkey);
            setInputValue("tileX", tile.tileX);
            setInputValue("tileY", tile.tileY);
            const boundingBox = AzureMaps.TileMath.TileXYToBoundingBox(tile.tileX, tile.tileY, zoomLevel, 256);
            const centerX = (boundingBox[0] + boundingBox[2]) / 2;
            const centerY = (boundingBox[1] + boundingBox[3]) / 2;
            setInputValue("longitude", orgRound(centerX, 4));
            setInputValue("latitude", orgRound(centerY, 4));
        }
    </script>
    <script type="text/javascript" src="scripts/TileMath.js"></script>
    <title>AzureMapsTileMathSite</title>
    <style>
        label
        {
            display:block;
            float:left;
            width:250px;
        }
    </style>
</head>
<body>
<ul>
    <li>
        <form onsubmit="setZoomLevel();return false">
            <label for="zoomLevel">Zoom Level</label><input type="number" id="zoomLevel" value="12" />
            <button type="submit" class="btn btn-primary">Set ZoomLevel</button>
        </form>
    </li>
    <li>
        <form onsubmit="convertFromLatLon();return false">
            <ul>
                <li>
                    <label for="longitude">X / 経度 / longitude</label><input type="number" id="longitude" value="139.70" step="0.0001" />
                </li>
                <li>
                    <label for="latitude">Y / 緯度 / latitude</label><input type="number" id="latitude" value="35.68" step="0.0001" />
                </li>
            </ul>
            <button type="submit" class="btn btn-primary">Convert</button>
        </form>
    </li>
    <li>
        <form onsubmit="convertFromTile();return false">
            <ul>
                <li>
                    <label for="tileX">TileX</label><input type="number" id="tileX" value="3637" />
                </li>
                <li>
                    <label for="tileY">TileY</label><input type="number" id="tileY" value="1612" />
                </li>
            </ul>
            <button type="submit" class="btn btn-primary">Convert</button>
        </form>
    </li>
    <li>
        <form onsubmit="convertFromQuadKey();return false">
            <label for="quadkey">quadkey</label><input type="number" id="quadkey" value="133002112301" />
            <button type="submit" class="btn btn-primary">Convert</button>
        </form>
    </li>
</ul>
</body>
</html>